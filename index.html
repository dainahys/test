<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2026 ì•± ë‹¤ìš´ë¡œë“œ í”„ë¡œëª¨ì…˜ - ì¸í„°ë™í‹°ë¸Œ í”„ë¡œí† íƒ€ì…</title>
<script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #f1f5f9; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useRef } = React;

const App = () => {
  const [screen, setScreen] = useState('web');
  const [history, setHistory] = useState([]);
  const logRef = useRef(null);

  const [alreadyParticipated, setAlreadyParticipated] = useState(false);
  const [consentAll, setConsentAll] = useState(true);
  const [pushAuthStatus, setPushAuthStatus] = useState('authorized');
  const [foregroundPushEnabled, setForegroundPushEnabled] = useState(true);
  const [termsChecked, setTermsChecked] = useState({ marketing_info: false, marketing_message: false });

  const addHistory = (action, type = 'action') => {
    setHistory(prev => [...prev, { time: new Date().toLocaleTimeString(), action, type }]);
  };

  useEffect(() => {
    if (logRef.current) logRef.current.scrollTop = logRef.current.scrollHeight;
  }, [history]);

  const reset = () => {
    setScreen('web');
    setAlreadyParticipated(false);
    setConsentAll(true);
    setPushAuthStatus('authorized');
    setForegroundPushEnabled(true);
    setTermsChecked({ marketing_info: false, marketing_message: false });
    setHistory([]);
  };

  const PhoneFrame = ({ children }) => (
    <div style={{ position: 'relative', margin: '0 auto', width: 375, height: 720 }}>
      <div style={{ position: 'absolute', inset: -12, background: '#1a1a1a', borderRadius: 48, boxShadow: '0 25px 60px rgba(0,0,0,0.3), inset 0 0 0 2px rgba(255,255,255,0.1)' }} />
      <div style={{ position: 'absolute', top: -12, left: '50%', transform: 'translateX(-50%)', width: 130, height: 28, background: '#1a1a1a', borderRadius: '0 0 18px 18px', zIndex: 10 }} />
      <div style={{ position: 'relative', width: '100%', height: '100%', borderRadius: 36, overflow: 'hidden', background: '#fff', zIndex: 5 }}>
        {children}
      </div>
    </div>
  );

  const EventBadge = ({ event, properties }) => (
    <div style={{ margin: '8px 0', padding: '8px 10px', background: 'linear-gradient(135deg, #2d1b69, #1e1145)', borderRadius: 8, fontSize: 10, fontFamily: 'monospace', lineHeight: 1.5 }}>
      <div style={{ color: '#a78bfa', fontWeight: 700, marginBottom: 2 }}>ğŸ“¤ {event}</div>
      {Object.entries(properties).map(([k, v]) => (
        <div key={k} style={{ color: '#94a3b8' }}>
          <span style={{ color: '#67e8f9' }}>{k}</span>: <span style={{ color: '#fde68a' }}>{String(v)}</span>
        </div>
      ))}
    </div>
  );

  const AppHeader = () => (
    <div style={{ background: '#7c3aed', padding: '44px 16px 12px', display: 'flex', alignItems: 'center', gap: 8 }}>
      <div style={{ width: 28, height: 28, background: 'rgba(255,255,255,0.2)', borderRadius: 8, display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff', fontSize: 14, fontWeight: 800 }}>ìˆ¨</div>
      <span style={{ color: '#fff', fontWeight: 600, fontSize: 15 }}>ìˆ¨ê³ </span>
    </div>
  );

  // === ì›¹ ===
  const WebScreen = () => (
    <div style={{ display: 'flex', flexDirection: 'column', height: '100%', background: 'linear-gradient(to bottom, #5b21b6, #7c3aed, #a855f7)' }}>
      <div style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', padding: 24, color: '#fff', textAlign: 'center' }}>
        <div style={{ fontSize: 56, marginBottom: 12 }}>ğŸ“±</div>
        <h1 style={{ fontSize: 22, fontWeight: 800, margin: '0 0 6px', letterSpacing: -0.5 }}>ìˆ¨ê³  ì•± ë‹¤ìš´ë¡œë“œ</h1>
        <p style={{ fontSize: 14, color: 'rgba(255,255,255,0.7)', marginBottom: 20, lineHeight: 1.5 }}>ì§€ê¸ˆ ì•± ì„¤ì¹˜í•˜ê³ <br/>íŠ¹ë³„í•œ í˜œíƒ ë°›ì•„ê°€ì„¸ìš”!</p>
        <div style={{ background: 'rgba(255,255,255,0.15)', borderRadius: 16, padding: '16px 24px', width: '100%', maxWidth: 260 }}>
          <div style={{ fontSize: 12, color: 'rgba(255,255,255,0.6)', marginBottom: 4 }}>3ì›” ì•± ë‹¤ìš´ë¡œë“œ ê²½í’ˆ</div>
          <div style={{ fontSize: 16, fontWeight: 700 }}>ğŸ† ë¶ì¤‘ë¯¸ ì›”ë“œì»µ í‹°ì¼“</div>
          <div style={{ fontSize: 16, fontWeight: 700 }}>ğŸ½ï¸ ì´íƒ€ë‹‰ ê°€ë“  ì‹ì‚¬ê¶Œ</div>
        </div>
      </div>
      <div style={{ padding: 16, background: '#fff', borderRadius: '24px 24px 0 0' }}>
        <button onClick={() => { addHistory('ğŸŒ ì›¹ CTA í´ë¦­ â†’ ì—ì–´ë¸Œë¦¿ì§€ ë§í¬ í˜¸ì¶œ'); setScreen('routing'); }}
          style={{ width: '100%', padding: '16px 0', background: '#7c3aed', color: '#fff', fontWeight: 700, fontSize: 16, border: 'none', borderRadius: 14, cursor: 'pointer' }}>ì•± ë‹¤ìš´ë¡œë“œí•˜ê³  í˜œíƒ ë°›ê¸°</button>
        <p style={{ textAlign: 'center', color: '#a1a1aa', fontSize: 11, marginTop: 8 }}>â“˜ CTA = ì—ì–´ë¸Œë¦¿ì§€ ë‹¨ì¼ ë§í¬</p>
      </div>
    </div>
  );

  // === ë¼ìš°íŒ… ===
  const RoutingScreen = () => (
    <div style={{ display: 'flex', flexDirection: 'column', height: '100%', background: '#f8fafc', padding: 24 }}>
      <div style={{ textAlign: 'center', marginBottom: 24 }}>
        <div style={{ fontSize: 48, marginBottom: 8 }}>ğŸ”€</div>
        <h2 style={{ fontSize: 18, fontWeight: 700, color: '#1e293b', margin: 0 }}>ì—ì–´ë¸Œë¦¿ì§€ ë¼ìš°íŒ…</h2>
        <p style={{ fontSize: 13, color: '#94a3b8', marginTop: 4 }}>ì•± ì„¤ì¹˜ ìƒíƒœë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
      </div>
      <div style={{ flex: 1, display: 'flex', flexDirection: 'column', gap: 12 }}>
        <button onClick={() => { addHistory('ğŸ”€ ë¯¸ì„¤ì¹˜ â†’ ìŠ¤í† ì–´ ì´ë™'); setScreen('store'); }}
          style={{ flex: 1, background: '#fff', border: '2px solid #e2e8f0', borderRadius: 16, padding: 20, textAlign: 'center', cursor: 'pointer' }}>
          <div style={{ fontSize: 40, marginBottom: 8 }}>ğŸª</div>
          <div style={{ fontWeight: 700, color: '#1e293b', fontSize: 15 }}>ë¯¸ì„¤ì¹˜</div>
          <div style={{ fontSize: 12, color: '#94a3b8' }}>App Store / Play Store ì´ë™</div>
        </button>
        <button onClick={() => { addHistory('ğŸ”€ ê¸°ì„¤ì¹˜ â†’ ì•± ì˜¤í”ˆ (Direct Deep Link)'); setScreen('setup_exist'); }}
          style={{ flex: 1, background: '#fff', border: '2px solid #e2e8f0', borderRadius: 16, padding: 20, textAlign: 'center', cursor: 'pointer' }}>
          <div style={{ fontSize: 40, marginBottom: 8 }}>ğŸ“±</div>
          <div style={{ fontWeight: 700, color: '#1e293b', fontSize: 15 }}>ê¸°ì„¤ì¹˜</div>
          <div style={{ fontSize: 12, color: '#94a3b8' }}>ì•± ë°”ë¡œ ì—´ê¸° (Deep Link)</div>
        </button>
      </div>
    </div>
  );

  // === ìŠ¤í† ì–´ ===
  const StoreScreen = () => (
    <div style={{ display: 'flex', flexDirection: 'column', height: '100%', background: '#f8fafc', padding: 24 }}>
      <div style={{ textAlign: 'center', marginBottom: 20 }}>
        <div style={{ fontSize: 48, marginBottom: 8 }}>ğŸª</div>
        <h2 style={{ fontSize: 18, fontWeight: 700, color: '#1e293b', margin: 0 }}>App Store</h2>
      </div>
      <div style={{ background: '#fff', borderRadius: 16, padding: 16, display: 'flex', alignItems: 'center', gap: 14, boxShadow: '0 1px 3px rgba(0,0,0,0.06)' }}>
        <div style={{ width: 60, height: 60, background: '#7c3aed', borderRadius: 14, display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff', fontSize: 24, fontWeight: 800, flexShrink: 0 }}>ìˆ¨</div>
        <div>
          <div style={{ fontWeight: 700, fontSize: 15 }}>ìˆ¨ê³  - ìƒí™œì„œë¹„ìŠ¤ ì „ë¬¸ê°€ ë§¤ì¹­</div>
          <div style={{ fontSize: 12, color: '#94a3b8' }}>â­ 4.8 Â· ë¼ì´í”„ìŠ¤íƒ€ì¼</div>
        </div>
      </div>
      <div style={{ flex: 1 }} />
      <div style={{ display: 'flex', gap: 10 }}>
        <button onClick={() => { addHistory('âŒ ìŠ¤í† ì–´ ì´íƒˆ â†’ í”Œë¡œìš° ì¢…ë£Œ'); setScreen('exit'); }}
          style={{ flex: 1, padding: 14, background: '#e2e8f0', color: '#64748b', fontWeight: 600, border: 'none', borderRadius: 12, cursor: 'pointer', fontSize: 14 }}>ì´íƒˆ</button>
        <button onClick={() => { addHistory('âœ… ì„¤ì¹˜ ì™„ë£Œ â†’ ì•± ì²« ì‹¤í–‰ (Deferred Deep Link)'); setScreen('setup_new'); }}
          style={{ flex: 1, padding: 14, background: '#3b82f6', color: '#fff', fontWeight: 700, border: 'none', borderRadius: 12, cursor: 'pointer', fontSize: 14 }}>ì„¤ì¹˜</button>
      </div>
    </div>
  );

  // === ì‹œë®¬ë ˆì´ì…˜ ì„¤ì • ===
  const SetupScreen = ({ isNew }) => {
    const linkType = isNew ? 'deferred' : 'direct';
    const getTargetBranch = () => {
      if (alreadyParticipated) return 'A';
      if (!consentAll && linkType === 'direct') return 'B';
      if (!consentAll && linkType === 'deferred') return 'C';
      if (consentAll && pushAuthStatus === 'authorized') return 'D';
      if (consentAll && pushAuthStatus !== 'authorized') return 'E';
      return '?';
    };
    const branchLabels = { A: 'ì´ë¯¸ ì°¸ì—¬ ì™„ë£Œ', B: 'ê¸°ì„¤ì¹˜ + ì•½ê´€ ë¯¸ì¶©ì¡±', C: 'ì‹ ê·œ + ì•½ê´€ ë¯¸ì¶©ì¡±', D: 'ëª¨ë‘ ë™ì˜ + í‘¸ì‹œ OK â†’ ë°”ë¡œ ì™„ë£Œ', E: 'ëª¨ë‘ ë™ì˜ + í‘¸ì‹œ ë¯¸í—ˆìš©' };
    const branchColors = { A: '#22c55e', B: '#f59e0b', C: '#f59e0b', D: '#22c55e', E: '#ef4444' };

    const startFlow = () => {
      const branch = getTargetBranch();
      addHistory(`ğŸ“± ì•± ì‹¤í–‰ (${isNew ? 'ì‹ ê·œ' : 'ê¸°ì„¤ì¹˜'})`, 'section');
      addHistory(`ğŸ“¤ setCustomAttribute('push_authorization_status', '${pushAuthStatus}')`, 'event');
      addHistory(`ğŸ“¤ logCustomEvent('deeplink_open_promotion', {link_type: '${linkType}', term: 'appinstall_2603'})`, 'event');
      addHistory(`ğŸ¯ Braze ë¶„ê¸° â†’ ${branch}. ${branchLabels[branch]}`, 'branch');
      if (branch === 'A') setScreen('iam_already');
      else if (branch === 'B') setScreen('iam_exist_notice');
      else if (branch === 'C') setScreen('terms_modal');
      else if (branch === 'D') setScreen('iam_complete');
      else if (branch === 'E') {
        if (pushAuthStatus === 'not_determined') setScreen('push_primer_new');
        else setScreen('push_primer_denied');
      }
    };

    const branch = getTargetBranch();
    const Pill = ({ label, active, onClick, color }) => (
      <button onClick={onClick} style={{
        flex: 1, padding: '8px 4px', border: `2px solid ${active ? (color || '#7c3aed') : '#e2e8f0'}`,
        background: active ? (color || '#7c3aed') + '18' : '#fff',
        borderRadius: 10, fontSize: 12, fontWeight: active ? 700 : 500,
        color: active ? (color || '#7c3aed') : '#64748b', cursor: 'pointer', transition: 'all 0.15s'
      }}>{label}</button>
    );

    return (
      <div style={{ display: 'flex', flexDirection: 'column', height: '100%', background: '#f1f5f9', padding: 16 }}>
        <div style={{ textAlign: 'center', marginBottom: 12 }}>
          <div style={{ fontSize: 32, marginBottom: 4 }}>ğŸ®</div>
          <h2 style={{ fontSize: 16, fontWeight: 700, color: '#1e293b', margin: 0 }}>ì‹œë®¬ë ˆì´ì…˜ ì„¤ì •</h2>
          <p style={{ fontSize: 11, color: '#94a3b8', margin: '4px 0 0' }}>{isNew ? 'ì‹ ê·œ ì„¤ì¹˜' : 'ê¸°ì„¤ì¹˜'} ìœ ì € í”Œë¡œìš°</p>
        </div>
        <div style={{ flex: 1, overflowY: 'auto', display: 'flex', flexDirection: 'column', gap: 10 }}>
          <div style={{ background: '#fff', borderRadius: 12, padding: 12 }}>
            <div style={{ fontSize: 12, fontWeight: 600, color: '#475569', marginBottom: 6 }}>is_participated_promotion_appinstall2603</div>
            <div style={{ display: 'flex', gap: 6 }}>
              <Pill label="false (ì²« ì°¸ì—¬)" active={!alreadyParticipated} onClick={() => setAlreadyParticipated(false)} />
              <Pill label="true (ì´ë¯¸ ì°¸ì—¬)" active={alreadyParticipated} onClick={() => setAlreadyParticipated(true)} color="#22c55e" />
            </div>
          </div>
          {!alreadyParticipated && (<>
            <div style={{ background: '#fff', borderRadius: 12, padding: 12 }}>
              <div style={{ fontSize: 12, fontWeight: 600, color: '#475569', marginBottom: 6 }}>ì•½ê´€ 4ê°œ attr ì¶©ì¡± ì—¬ë¶€</div>
              <div style={{ display: 'flex', gap: 6 }}>
                <Pill label="ëª¨ë‘ ì¶©ì¡±" active={consentAll} onClick={() => setConsentAll(true)} color="#22c55e" />
                <Pill label="ë¯¸ì¶©ì¡± ìˆìŒ" active={!consentAll} onClick={() => setConsentAll(false)} color="#f59e0b" />
              </div>
              <div style={{ fontSize: 10, color: '#94a3b8', marginTop: 6, lineHeight: 1.4 }}>is_marketing_info_opted_in, is_marketing_message_opted_in, email_subscribe, push_subscribe</div>
            </div>
            <div style={{ background: '#fff', borderRadius: 12, padding: 12 }}>
              <div style={{ fontSize: 12, fontWeight: 600, color: '#475569', marginBottom: 6 }}>push_authorization_status</div>
              <div style={{ display: 'flex', gap: 6 }}>
                <Pill label="authorized" active={pushAuthStatus === 'authorized'} onClick={() => { setPushAuthStatus('authorized'); setForegroundPushEnabled(true); }} color="#22c55e" />
                <Pill label="not_determined" active={pushAuthStatus === 'not_determined'} onClick={() => { setPushAuthStatus('not_determined'); setForegroundPushEnabled(false); }} color="#6366f1" />
                <Pill label="denied" active={pushAuthStatus === 'denied'} onClick={() => { setPushAuthStatus('denied'); setForegroundPushEnabled(false); }} color="#ef4444" />
              </div>
              <div style={{ fontSize: 10, color: '#94a3b8', marginTop: 6, lineHeight: 1.4 }}>authorized â†’ Foreground Push Enabled = true / not_determinedÂ·denied â†’ false</div>
            </div>
          </>)}
          <div style={{ background: (branchColors[branch] || '#6366f1') + '12', border: `2px solid ${branchColors[branch] || '#6366f1'}`, borderRadius: 12, padding: 12, textAlign: 'center' }}>
            <div style={{ fontSize: 11, color: '#64748b', marginBottom: 2 }}>ì˜ˆìƒ ë¶„ê¸°</div>
            <div style={{ fontSize: 18, fontWeight: 800, color: branchColors[branch] || '#6366f1' }}>ë¶„ê¸° {branch}</div>
            <div style={{ fontSize: 12, color: '#475569', marginTop: 2 }}>{branchLabels[branch]}</div>
          </div>
        </div>
        <button onClick={startFlow} style={{ width: '100%', padding: 14, background: '#7c3aed', color: '#fff', fontWeight: 700, fontSize: 15, border: 'none', borderRadius: 12, cursor: 'pointer', marginTop: 12 }}>í”Œë¡œìš° ì‹œì‘</button>
      </div>
    );
  };

  // === ë¶„ê¸° A: ì´ë¯¸ ì°¸ì—¬ ===
  const IamAlready = () => (
    <div style={{ display: 'flex', flexDirection: 'column', height: '100%', background: '#f8fafc' }}>
      <AppHeader />
      <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: 24 }}>
        <div style={{ background: '#fff', borderRadius: 20, padding: 28, textAlign: 'center', boxShadow: '0 10px 40px rgba(0,0,0,0.1)', width: '100%' }}>
          <div style={{ width: 48, height: 48, background: '#dcfce7', borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto 16px', fontSize: 24 }}>âœ…</div>
          <h3 style={{ fontSize: 17, fontWeight: 700, color: '#1e293b', margin: '0 0 8px' }}>ì´ë¯¸ ì´ë²¤íŠ¸ ì°¸ì—¬ê°€<br/>ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</h3>
          <p style={{ fontSize: 13, color: '#94a3b8', margin: '0 0 8px' }}>ë‹¹ì²¨ ê²°ê³¼ëŠ” ì¶”í›„ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤</p>
          <EventBadge event="ë¶„ê¸° A: ì´ë¯¸ ì°¸ì—¬" properties={{ is_participated_promotion_appinstall2603: 'true' }} />
          <button onClick={() => { addHistory('âœ… [í™•ì¸] â†’ ìˆ¨ê³  í™ˆ'); setScreen('home_done'); }}
            style={{ width: '100%', padding: 14, background: '#22c55e', color: '#fff', fontWeight: 700, border: 'none', borderRadius: 12, cursor: 'pointer', marginTop: 8, fontSize: 14 }}>í™•ì¸</button>
        </div>
      </div>
    </div>
  );

  // === ë¶„ê¸° B: ê¸°ì„¤ì¹˜ ì•ˆë‚´ ===
  const IamExistNotice = () => (
    <div style={{ display: 'flex', flexDirection: 'column', height: '100%', background: '#f8fafc' }}>
      <AppHeader />
      <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: 24 }}>
        <div style={{ background: '#fff', borderRadius: 20, padding: 28, textAlign: 'center', boxShadow: '0 10px 40px rgba(0,0,0,0.1)', width: '100%' }}>
          <div style={{ fontSize: 40, marginBottom: 12 }}>ğŸ‘‹</div>
          <h3 style={{ fontSize: 17, fontWeight: 700, color: '#1e293b', margin: '0 0 8px' }}>ì´ë¯¸ ìˆ¨ê³  ì•±ì´<br/>ì„¤ì¹˜ë˜ì–´ ìˆì–´ìš”!</h3>
          <p style={{ fontSize: 13, color: '#64748b', margin: '0 0 6px', lineHeight: 1.5 }}>ë§ˆì¼€íŒ… ì•± ì•Œë¦¼ì„ ì¼œì£¼ì…”ì•¼<br/>ì‘ëª¨ê°€ ì™„ë£Œë¼ìš”</p>
          <EventBadge event="view_has_app_modal" properties={{ event_name: 'promotion_appinstall_2603' }} />
          <button onClick={() => { addHistory('ğŸ“¡ [ì‘ëª¨ ì™„ë£Œí•˜ê¸°] â†’ ì•½ê´€ ë™ì˜ ëª¨ë‹¬'); setScreen('terms_modal'); }}
            style={{ width: '100%', padding: 14, background: '#7c3aed', color: '#fff', fontWeight: 700, border: 'none', borderRadius: 12, cursor: 'pointer', marginTop: 8, fontSize: 14 }}>ì‘ëª¨ ì™„ë£Œí•˜ê¸°</button>
        </div>
      </div>
    </div>
  );

  // === ì•½ê´€ ë™ì˜ ===
  const TermsModal = () => {
    const allChecked = termsChecked.marketing_info && termsChecked.marketing_message;
    return (
      <div style={{ display: 'flex', flexDirection: 'column', height: '100%', background: '#f8fafc' }}>
        <AppHeader />
        <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: 24 }}>
          <div style={{ background: '#fff', borderRadius: 20, padding: 24, boxShadow: '0 10px 40px rgba(0,0,0,0.1)', width: '100%' }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: 6, marginBottom: 16 }}>
              <span style={{ background: '#f43f5e', color: '#fff', padding: '2px 8px', borderRadius: 6, fontSize: 10, fontWeight: 700 }}>Custom HTML IAM</span>
              <span style={{ fontSize: 14, fontWeight: 700, color: '#1e293b' }}>ì•½ê´€ ë™ì˜</span>
            </div>
            <EventBadge event="view_terms_consent_modal" properties={{ displayed_items: "['marketing_info','marketing_message']" }} />
            {[
              { key: 'marketing_info', label: 'ê°œì¸ì •ë³´ ë§ˆì¼€íŒ… í™œìš© ë™ì˜' },
              { key: 'marketing_message', label: 'ë§ˆì¼€íŒ… ì•Œë¦¼ ìˆ˜ì‹  ë™ì˜' },
            ].map(item => (
              <div key={item.key} onClick={() => setTermsChecked(prev => ({ ...prev, [item.key]: !prev[item.key] }))} style={{
                display: 'flex', alignItems: 'center', gap: 10, padding: '12px 14px',
                background: termsChecked[item.key] ? '#f0fdf4' : '#f8fafc',
                border: `2px solid ${termsChecked[item.key] ? '#22c55e' : '#e2e8f0'}`,
                borderRadius: 12, marginBottom: 8, cursor: 'pointer', transition: 'all 0.15s', userSelect: 'none'
              }}>
                <div style={{
                  width: 22, height: 22, borderRadius: 6,
                  background: termsChecked[item.key] ? '#22c55e' : '#fff',
                  border: `2px solid ${termsChecked[item.key] ? '#22c55e' : '#d1d5db'}`,
                  display: 'flex', alignItems: 'center', justifyContent: 'center',
                  color: '#fff', fontSize: 13, fontWeight: 700, flexShrink: 0
                }}>{termsChecked[item.key] ? 'âœ“' : ''}</div>
                <span style={{ fontSize: 13, color: '#334155', fontWeight: 500 }}>{item.label}</span>
              </div>
            ))}
            <button onClick={() => {
              if (!allChecked) return;
              addHistory('ğŸ“ [ì‘ëª¨ ì™„ë£Œí•˜ê¸°] í´ë¦­ (is_all_checked: true)', 'event');
              addHistory("ğŸ“ brazeBridge: setCustomUserAttribute('is_marketing_info_opted_in', true)", 'event');
              addHistory("ğŸ“ brazeBridge: setCustomUserAttribute('is_marketing_message_opted_in', true)", 'event');
              addHistory("ğŸ“ brazeBridge: setEmailNotificationSubscriptionType('opted_in')", 'event');
              addHistory("ğŸ“ brazeBridge: setPushNotificationSubscriptionType('opted_in')", 'event');
              addHistory("ğŸ“ brazeBridge: fetch('/api/consent') â†’ DB ì €ì¥", 'event');
              addHistory('ğŸ“ brazeBridge: requestImmediateDataFlush()', 'event');
              addHistory(`ğŸ¯ push_authorization_status í™•ì¸ â†’ ${pushAuthStatus}`, 'branch');
              if (pushAuthStatus === 'authorized') setScreen('iam_complete');
              else if (pushAuthStatus === 'not_determined') setScreen('push_primer_new');
              else setScreen('push_primer_denied');
            }} style={{
              width: '100%', padding: 14, marginTop: 8,
              background: allChecked ? '#7c3aed' : '#e2e8f0',
              color: allChecked ? '#fff' : '#a1a1aa',
              fontWeight: 700, fontSize: 14, border: 'none', borderRadius: 12,
              cursor: allChecked ? 'pointer' : 'not-allowed', transition: 'all 0.2s'
            }}>ì‘ëª¨ ì™„ë£Œí•˜ê¸°</button>
          </div>
        </div>
      </div>
    );
  };

  // === Push Primer: not_determined ===
  const PushPrimerNew = () => (
    <div style={{ display: 'flex', flexDirection: 'column', height: '100%', background: '#f8fafc' }}>
      <AppHeader />
      <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: 24 }}>
        <div style={{ background: '#fff', borderRadius: 20, padding: 28, textAlign: 'center', boxShadow: '0 10px 40px rgba(0,0,0,0.1)', width: '100%' }}>
          <div style={{ fontSize: 40, marginBottom: 12 }}>ğŸ””</div>
          <h3 style={{ fontSize: 16, fontWeight: 700, color: '#1e293b', margin: '0 0 8px' }}>ê¸°ê¸° ì•Œë¦¼ì„ ì¼œì£¼ì…”ì•¼<br/>ì´ë²¤íŠ¸ ì°¸ì—¬ê°€ ì™„ë£Œë¼ìš”!</h3>
          <EventBadge event="Push Primer IAM" properties={{ push_authorization_status: 'not_determined', segment: 'ì•½ê´€ 4ê°œ ì¶©ì¡± + Foreground Push = false' }} />
          <button onClick={() => { addHistory('ğŸ”” [ì•Œë¦¼ í—ˆìš©í•˜ê¸°] â†’ OS ê¶Œí•œ í”„ë¡¬í”„íŠ¸'); setScreen('os_prompt'); }}
            style={{ width: '100%', padding: 14, background: '#3b82f6', color: '#fff', fontWeight: 700, border: 'none', borderRadius: 12, cursor: 'pointer', marginTop: 8, fontSize: 14 }}>ì•Œë¦¼ í—ˆìš©í•˜ê¸°</button>
          <button onClick={() => {
            addHistory('âœ• [ë‹«ê¸°] â†’ push_permission denied');
            addHistory("ğŸ“¤ setCustomAttribute('push_authorization_status', 'denied')", 'event');
            addHistory("ğŸ“¤ logCustomEvent('push_permission', {status: 'denied', source: 'prompt'})", 'event');
            setScreen('iam_fail');
          }} style={{ width: '100%', padding: 10, background: 'transparent', color: '#94a3b8', fontWeight: 500, border: 'none', cursor: 'pointer', marginTop: 4, fontSize: 13 }}>ë‹«ê¸°</button>
        </div>
      </div>
    </div>
  );

  // === Push Primer: denied ===
  const PushPrimerDenied = () => (
    <div style={{ display: 'flex', flexDirection: 'column', height: '100%', background: '#f8fafc' }}>
      <AppHeader />
      <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: 24 }}>
        <div style={{ background: '#fff', borderRadius: 20, padding: 28, textAlign: 'center', boxShadow: '0 10px 40px rgba(0,0,0,0.1)', width: '100%' }}>
          <div style={{ fontSize: 40, marginBottom: 12 }}>ğŸ””</div>
          <h3 style={{ fontSize: 16, fontWeight: 700, color: '#1e293b', margin: '0 0 8px' }}>ì„¤ì •ì—ì„œ ì•Œë¦¼ì„ ì¼œì£¼ì…”ì•¼<br/>ì´ë²¤íŠ¸ ì°¸ì—¬ê°€ ì™„ë£Œë¼ìš”!</h3>
          <EventBadge event="Push Primer IAM" properties={{ push_authorization_status: 'denied', segment: 'ì•½ê´€ 4ê°œ ì¶©ì¡± + Foreground Push = false' }} />
          <button onClick={() => { addHistory('âš™ï¸ [ì„¤ì •ì—ì„œ ì¼œê¸°] â†’ ì„¤ì • ì•± ë”¥ë§í¬'); setScreen('settings'); }}
            style={{ width: '100%', padding: 14, background: '#6b7280', color: '#fff', fontWeight: 700, border: 'none', borderRadius: 12, cursor: 'pointer', marginTop: 8, fontSize: 14 }}>ì„¤ì •ì—ì„œ ì¼œê¸°</button>
          <button onClick={() => {
            addHistory('âœ• [ë‹«ê¸°] â†’ push_permission denied');
            addHistory("ğŸ“¤ setCustomAttribute('push_authorization_status', 'denied')", 'event');
            addHistory("ğŸ“¤ logCustomEvent('push_permission', {status: 'denied', source: 'prompt'})", 'event');
            setScreen('iam_fail');
          }} style={{ width: '100%', padding: 10, background: 'transparent', color: '#94a3b8', fontWeight: 500, border: 'none', cursor: 'pointer', marginTop: 4, fontSize: 13 }}>ë‹«ê¸°</button>
        </div>
      </div>
    </div>
  );

  // === OS ê¶Œí•œ í”„ë¡¬í”„íŠ¸ ===
  const OsPrompt = () => (
    <div style={{ display: 'flex', flexDirection: 'column', height: '100%', background: 'rgba(0,0,0,0.4)' }}>
      <AppHeader />
      <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: 24 }}>
        <div style={{ background: '#fff', borderRadius: 16, padding: 24, textAlign: 'center', width: 280, boxShadow: '0 20px 60px rgba(0,0,0,0.25)' }}>
          <h3 style={{ fontSize: 16, fontWeight: 600, color: '#1e293b', margin: '0 0 8px' }}>"ìˆ¨ê³ "ì´(ê°€) ì•Œë¦¼ì„<br/>ë³´ë‚´ê³ ì í•©ë‹ˆë‹¤</h3>
          <p style={{ fontSize: 12, color: '#64748b', margin: '0 0 16px', lineHeight: 1.4 }}>ê²½ê³ , ì‚¬ìš´ë“œ ë° ì•„ì´ì½˜ ë°°ì§€ê°€<br/>ì•Œë¦¼ì— í¬í•¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
          <div style={{ display: 'flex', borderTop: '1px solid #e2e8f0' }}>
            <button onClick={() => {
              addHistory('ğŸ”• OS ê¶Œí•œ â†’ ê±°ë¶€');
              addHistory("ğŸ“¤ setCustomAttribute('push_authorization_status', 'denied')", 'event');
              addHistory("ğŸ“¤ logCustomEvent('push_permission', {status: 'denied', source: 'prompt'})", 'event');
              setScreen('iam_fail');
            }} style={{ flex: 1, padding: 12, background: 'transparent', color: '#3b82f6', fontWeight: 400, border: 'none', cursor: 'pointer', borderRight: '1px solid #e2e8f0', fontSize: 15 }}>í—ˆìš© ì•ˆ í•¨</button>
            <button onClick={() => {
              addHistory('ğŸ”” OS ê¶Œí•œ â†’ í—ˆìš©');
              addHistory("ğŸ“¤ setCustomAttribute('push_authorization_status', 'authorized')", 'event');
              addHistory("ğŸ“¤ logCustomEvent('push_permission', {status: 'granted', source: 'prompt'})", 'event');
              setScreen('iam_complete');
            }} style={{ flex: 1, padding: 12, background: 'transparent', color: '#3b82f6', fontWeight: 600, border: 'none', cursor: 'pointer', fontSize: 15 }}>í—ˆìš©</button>
          </div>
        </div>
      </div>
    </div>
  );

  // === ì„¤ì • ì•± ===
  const SettingsScreen = () => (
    <div style={{ display: 'flex', flexDirection: 'column', height: '100%', background: '#f2f2f7' }}>
      <div style={{ background: '#f2f2f7', padding: '48px 16px 12px', borderBottom: '1px solid #c6c6c8' }}>
        <div style={{ fontSize: 11, color: '#3b82f6', marginBottom: 4 }}>â† ìˆ¨ê³ </div>
        <h2 style={{ fontSize: 28, fontWeight: 700, color: '#000', margin: 0 }}>ì•Œë¦¼</h2>
      </div>
      <div style={{ flex: 1, padding: 16 }}>
        <div style={{ background: '#fff', borderRadius: 12, overflow: 'hidden' }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '12px 16px', borderBottom: '1px solid #e5e5e7' }}>
            <span style={{ fontSize: 15 }}>ì•Œë¦¼ í—ˆìš©</span>
            <div style={{ width: 44, height: 26, borderRadius: 13, background: '#e5e5e7', position: 'relative' }}>
              <div style={{ width: 22, height: 22, borderRadius: 11, background: '#fff', position: 'absolute', top: 2, left: 2, boxShadow: '0 1px 3px rgba(0,0,0,0.2)' }} />
            </div>
          </div>
        </div>
        <p style={{ fontSize: 12, color: '#8e8e93', padding: '8px 16px', lineHeight: 1.4 }}>ì•Œë¦¼ì„ í—ˆìš©í•˜ë©´ ì´ë²¤íŠ¸ ì°¸ì—¬ê°€ ì™„ë£Œë©ë‹ˆë‹¤.</p>
      </div>
      <div style={{ padding: 16, display: 'flex', gap: 10 }}>
        <button onClick={() => {
          addHistory('ğŸ”• ì„¤ì •: ê±°ë¶€ ìœ ì§€ â†’ ì•± ë³µê·€');
          addHistory("ğŸ“¤ logCustomEvent('push_permission', {status: 'denied', source: 'settings'})", 'event');
          setScreen('iam_fail');
        }} style={{ flex: 1, padding: 14, background: '#e2e8f0', color: '#64748b', fontWeight: 600, border: 'none', borderRadius: 12, cursor: 'pointer', fontSize: 14 }}>ê±°ë¶€ ìœ ì§€</button>
        <button onClick={() => {
          addHistory('ğŸ”” ì„¤ì •: ì•Œë¦¼ í—ˆìš© â†’ ì•± ë³µê·€');
          addHistory("ğŸ“¤ setCustomAttribute('push_authorization_status', 'authorized')", 'event');
          addHistory("ğŸ“¤ logCustomEvent('push_permission', {status: 'granted', source: 'settings'})", 'event');
          setScreen('iam_complete');
        }} style={{ flex: 1, padding: 14, background: '#22c55e', color: '#fff', fontWeight: 700, border: 'none', borderRadius: 12, cursor: 'pointer', fontSize: 14 }}>í—ˆìš©í•˜ê¸°</button>
      </div>
    </div>
  );

  // === ì°¸ì—¬ ì™„ë£Œ ===
  const IamComplete = () => (
    <div style={{ display: 'flex', flexDirection: 'column', height: '100%', background: '#f8fafc' }}>
      <AppHeader />
      <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: 24 }}>
        <div style={{ background: 'linear-gradient(135deg, #fff 0%, #f0fdf4 100%)', borderRadius: 20, padding: 28, textAlign: 'center', boxShadow: '0 10px 40px rgba(0,0,0,0.1)', border: '2px solid #bbf7d0', width: '100%' }}>
          <div style={{ fontSize: 48, marginBottom: 8 }}>ğŸ‰</div>
          <h3 style={{ fontSize: 18, fontWeight: 800, color: '#15803d', margin: '0 0 8px' }}>ì´ë²¤íŠ¸ ì°¸ì—¬ ì™„ë£Œ!</h3>
          <div style={{ display: 'flex', flexDirection: 'column', gap: 8, margin: '16px 0' }}>
            {['ğŸ† ë¶ì¤‘ë¯¸ ì›”ë“œì»µ í‹°ì¼“', 'ğŸ½ï¸ ì´íƒ€ë‹‰ ê°€ë“  ì‹ì‚¬ê¶Œ'].map(item => (
              <div key={item} style={{ background: '#f0fdf4', borderRadius: 10, padding: '10px 14px', fontSize: 13, fontWeight: 600, color: '#166534', textAlign: 'center' }}>{item}</div>
            ))}
          </div>
          <p style={{ fontSize: 12, color: '#64748b', margin: '0 0 4px' }}>ë‹¹ì²¨ ê²°ê³¼ëŠ” ì¶”í›„ ê°œë³„ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤</p>
          <EventBadge event="view_participated_promotion_modal" properties={{ event_name: 'promotion_appinstall_2603', 'attr ìƒì„±': 'is_participated_promotion_appinstall2603 = true' }} />
          <button onClick={() => {
            addHistory('ğŸ“¡ view_participated_promotion_modal â†’ attr ìƒì„±');
            addHistory("ğŸ“¤ setCustomAttribute('is_participated_promotion_appinstall2603', true)", 'event');
            addHistory('ğŸ“¤ requestImmediateDataFlush()', 'event');
            addHistory('ğŸ‰ ì´ë²¤íŠ¸ ì°¸ì—¬ ì™„ë£Œ!', 'success');
            setScreen('home_done');
          }} style={{ width: '100%', padding: 14, background: '#22c55e', color: '#fff', fontWeight: 700, border: 'none', borderRadius: 12, cursor: 'pointer', marginTop: 8, fontSize: 14 }}>í™•ì¸</button>
        </div>
      </div>
    </div>
  );

  // === ì°¸ì—¬ ì‹¤íŒ¨ ===
  const IamFail = () => (
    <div style={{ display: 'flex', flexDirection: 'column', height: '100%', background: '#f8fafc' }}>
      <AppHeader />
      <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: 24 }}>
        <div style={{ background: '#fff', borderRadius: 20, padding: 28, textAlign: 'center', boxShadow: '0 10px 40px rgba(0,0,0,0.1)', width: '100%' }}>
          <div style={{ fontSize: 40, marginBottom: 12 }}>ğŸ”•</div>
          <h3 style={{ fontSize: 16, fontWeight: 700, color: '#dc2626', margin: '0 0 8px' }}>ì´ë²¤íŠ¸ ì°¸ì—¬ë¥¼<br/>ì™„ë£Œí•  ìˆ˜ ì—†ì–´ìš”</h3>
          <p style={{ fontSize: 13, color: '#64748b', margin: '0 0 6px', lineHeight: 1.5 }}>ë§ˆì¼€íŒ… ìˆ˜ì‹  ë™ì˜ì™€ ì•Œë¦¼ ê¶Œí•œì´<br/>ëª¨ë‘ ì¼œì ¸ì•¼ ì´ë²¤íŠ¸ ì°¸ì—¬ê°€ ì™„ë£Œë©ë‹ˆë‹¤.</p>
          <EventBadge event="push_permission" properties={{ status: 'denied' }} />
          <button onClick={() => { addHistory('âŒ ì´ë²¤íŠ¸ ë¯¸ì™„ë£Œ â†’ ìˆ¨ê³  í™ˆ'); setScreen('home_fail'); }}
            style={{ width: '100%', padding: 14, background: '#ef4444', color: '#fff', fontWeight: 700, border: 'none', borderRadius: 12, cursor: 'pointer', marginTop: 8, fontSize: 14 }}>í™•ì¸</button>
        </div>
      </div>
    </div>
  );

  // === í™ˆ ===
  const HomeScreen = ({ success }) => (
    <div style={{ display: 'flex', flexDirection: 'column', height: '100%', background: '#f8fafc' }}>
      <AppHeader />
      <div style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', padding: 24, textAlign: 'center' }}>
        <div style={{ fontSize: 56, marginBottom: 16 }}>ğŸ </div>
        <h2 style={{ fontSize: 20, fontWeight: 700, color: '#1e293b', margin: '0 0 8px' }}>ìˆ¨ê³  í™ˆ</h2>
        <div style={{ display: 'inline-flex', alignItems: 'center', gap: 6, padding: '6px 14px', borderRadius: 20, fontSize: 13, fontWeight: 600, background: success ? '#dcfce7' : '#fee2e2', color: success ? '#15803d' : '#dc2626' }}>
          {success ? 'âœ… ì´ë²¤íŠ¸ ì™„ë£Œ' : 'âŒ ì´ë²¤íŠ¸ ë¯¸ì™„ë£Œ'}
        </div>
      </div>
      <div style={{ padding: 16 }}>
        <button onClick={reset} style={{ width: '100%', padding: 14, background: '#1e293b', color: '#fff', fontWeight: 700, fontSize: 14, border: 'none', borderRadius: 12, cursor: 'pointer' }}>ğŸ”„ ì²˜ìŒë¶€í„° ë‹¤ì‹œ</button>
      </div>
    </div>
  );

  // === ì´íƒˆ ===
  const ExitScreen = () => (
    <div style={{ display: 'flex', flexDirection: 'column', height: '100%', background: '#fef2f2', alignItems: 'center', justifyContent: 'center', padding: 24, textAlign: 'center' }}>
      <div style={{ fontSize: 56, marginBottom: 16 }}>âŒ</div>
      <h2 style={{ fontSize: 20, fontWeight: 700, color: '#dc2626', margin: '0 0 8px' }}>ì´íƒˆ</h2>
      <p style={{ fontSize: 14, color: '#64748b' }}>í”Œë¡œìš° ì¢…ë£Œ</p>
      <button onClick={reset} style={{ marginTop: 24, padding: '12px 32px', background: '#1e293b', color: '#fff', fontWeight: 700, fontSize: 14, border: 'none', borderRadius: 12, cursor: 'pointer' }}>ğŸ”„ ì²˜ìŒë¶€í„° ë‹¤ì‹œ</button>
    </div>
  );

  const renderScreen = () => {
    switch (screen) {
      case 'web': return <WebScreen />;
      case 'routing': return <RoutingScreen />;
      case 'store': return <StoreScreen />;
      case 'setup_new': return <SetupScreen isNew={true} />;
      case 'setup_exist': return <SetupScreen isNew={false} />;
      case 'iam_already': return <IamAlready />;
      case 'iam_exist_notice': return <IamExistNotice />;
      case 'terms_modal': return <TermsModal />;
      case 'push_primer_new': return <PushPrimerNew />;
      case 'push_primer_denied': return <PushPrimerDenied />;
      case 'os_prompt': return <OsPrompt />;
      case 'settings': return <SettingsScreen />;
      case 'iam_complete': return <IamComplete />;
      case 'iam_fail': return <IamFail />;
      case 'home_done': return <HomeScreen success={true} />;
      case 'home_fail': return <HomeScreen success={false} />;
      case 'exit': return <ExitScreen />;
      default: return <WebScreen />;
    }
  };

  const logStyles = {
    section: { background: '#312e81', borderLeft: '3px solid #818cf8' },
    event: { background: '#1e1b4b', borderLeft: '3px solid #a78bfa' },
    branch: { background: '#134e4a', borderLeft: '3px solid #14b8a6' },
    success: { background: '#14532d', borderLeft: '3px solid #22c55e' },
    action: { background: '#1e293b', borderLeft: '3px solid #475569' },
  };

  return (
    <div style={{ display: 'flex', gap: 32, maxWidth: 1100, margin: '0 auto', padding: '24px 16px', minHeight: '100vh', alignItems: 'flex-start', fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif' }}>
      <div style={{ flexShrink: 0 }}>
        <h2 style={{ fontSize: 14, fontWeight: 700, color: '#64748b', textAlign: 'center', marginBottom: 16, textTransform: 'uppercase', letterSpacing: 1 }}>ğŸ“± App Simulator</h2>
        <PhoneFrame>{renderScreen()}</PhoneFrame>
      </div>
      <div style={{ flex: 1, minWidth: 0 }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 12 }}>
          <h2 style={{ fontSize: 14, fontWeight: 700, color: '#64748b', textTransform: 'uppercase', letterSpacing: 1, margin: 0 }}>ğŸ“‹ Action Log</h2>
          <button onClick={() => setHistory([])} style={{ fontSize: 11, color: '#94a3b8', background: 'transparent', border: '1px solid #e2e8f0', padding: '4px 10px', borderRadius: 6, cursor: 'pointer' }}>Clear</button>
        </div>
        <div ref={logRef} style={{ background: '#0f172a', borderRadius: 16, padding: 16, height: 700, overflowY: 'auto', display: 'flex', flexDirection: 'column', gap: 6 }}>
          {history.length === 0 ? (
            <p style={{ color: '#475569', fontSize: 13, textAlign: 'center', marginTop: 40 }}>CTAë¥¼ í´ë¦­í•˜ë©´ ë¡œê·¸ê°€ ê¸°ë¡ë©ë‹ˆë‹¤</p>
          ) : (
            history.map((item, i) => (
              <div key={i} style={{ ...(logStyles[item.type] || logStyles.action), borderRadius: 8, padding: '8px 12px', fontSize: 12 }}>
                <span style={{ color: '#64748b', fontSize: 10 }}>{item.time}</span>
                <div style={{ color: '#e2e8f0', marginTop: 2, lineHeight: 1.4, wordBreak: 'break-all' }}>{item.action}</div>
              </div>
            ))
          )}
        </div>
      </div>
    </div>
  );
};

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
